<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Amor em C√≥digos ‚Ä¢ Crie seu Mini Site</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#0b0a0f; --bg2:#121219; --card:#171720; --line:#262637;
      --text:#fbf9ff; --muted:#cbc6d8; --accent:#a78bfa; --brand1:#ff4d6d; --brand2:#ff99ac;
      --shadow:0 10px 24px rgba(167,139,250,.20), 0 8px 18px rgba(255,77,109,.12);
      --radius:20px; --maxw:1200px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:'Inter',system-ui,Arial,sans-serif;color:var(--text);
      background:
        radial-gradient(1200px 600px at 10% -10%, rgba(167,139,250,.18), transparent 60%),
        radial-gradient(900px 400px at 110% 10%, rgba(255,77,109,.14), transparent 60%), var(--bg);
      overflow-x:hidden;-webkit-font-smoothing:antialiased;text-rendering:optimizeLegibility}
    a{color:inherit}
    .wrap{max-width:var(--maxw); margin:0 auto; padding:0 clamp(14px,3vw,24px)}

    /* HEADER */
    header{position:sticky; top:0; z-index:40; backdrop-filter:saturate(160%) blur(8px);
      background:linear-gradient(180deg, rgba(13,12,18,.92), rgba(13,12,18,.65));
      border-bottom:1px solid rgba(255,255,255,.06)}
    .header-inner{display:flex; align-items:center; justify-content:space-between; gap:14px; padding:12px 0}
    .brand{display:flex; align-items:center; gap:12px}
    .brand-badge{width:38px; height:38px; border-radius:12px; background:linear-gradient(135deg,var(--accent),#7c3aed); box-shadow:var(--shadow); display:grid; place-items:center}
    .brand h1{font-size:clamp(16px,2.4vw,18px); margin:0}
    .btn{border:0; border-radius:12px; padding:10px 14px; font-weight:800; cursor:pointer; transition:transform .15s ease, filter .15s ease; background:#242432; color:var(--text)}
    .btn-primary{background:linear-gradient(135deg,var(--accent),#7c3aed)}
    .btn-ghost{background:#242432}
    .btn:active{transform:scale(.98)}

    /* HERO */
    .hero{padding:clamp(28px,6vw,56px) 0 24px}
    .hero-grid{display:grid; grid-template-columns:1.05fr .95fr; gap:clamp(18px,4vw,28px); align-items:center}
    .eyebrow{font-weight:800; letter-spacing:.14em; color:#cdb8ff; text-transform:uppercase; font-size:12px}
    .title{margin:6px 0 8px; font-weight:900; line-height:1.02; font-size:clamp(28px,6.2vw,56px);
      background:linear-gradient(135deg,#a78bfa 0%, #ffffff 40%, #ff99ac 100%); -webkit-background-clip:text; background-clip:text; color:transparent}
    .subtitle{color:var(--muted); font-size:clamp(14px,1.6vw,18px)}
    .cta{display:flex; gap:10px; align-items:center; margin-top:14px; flex-wrap:wrap}
    .note{font-size:12px; color:#bdb7c9}

    /* PHONE PREVIEW (lado direito) */
    .phone{position:relative; aspect-ratio:9/16; border-radius:34px; background:linear-gradient(160deg,#2a2835,#171622);
      border:1px solid rgba(255,255,255,.08); box-shadow:var(--shadow); overflow:hidden}
    .phone-screen{position:absolute; inset:12px; border-radius:24px; background:linear-gradient(180deg,#0e0d14,#161526); overflow:hidden}

    /* PREVIEW CONTENT */
    .preview{position:absolute; inset:0; display:grid; grid-template-rows:auto 1fr auto}
    .topbar{display:flex; align-items:center; justify-content:center; gap:8px; padding:8px 10px; background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03)); border-bottom:1px solid rgba(255,255,255,.06)}
    .topbar .dot{width:6px; height:6px; background:linear-gradient(135deg,var(--brand1),var(--brand2)); border-radius:999px; box-shadow:0 0 0 4px rgba(255,77,109,.15)}
    .titlebar{font-weight:800; letter-spacing:.03em}

    .slider{position:relative}
    .slide{position:absolute; inset:0; display:grid; grid-template-rows:1fr auto auto; gap:8px; padding:12px; opacity:0; transition:opacity .6s ease}
    .slide-inner{display:flex; align-items:center; justify-content:center}
    .slide img{max-width:100%; max-height:64%; border-radius:14px; box-shadow:0 10px 22px rgba(0,0,0,.5); object-fit:contain}
    .caption{display:flex; justify-content:center}
    .caption span{font-size:13px; color:#fff; background:rgba(0,0,0,.45); border:1px solid rgba(255,255,255,.12); padding:8px 12px; border-radius:10px}
    .since{font-size:12px; color:#ddd; text-align:center; opacity:.9}
    .slide.show{opacity:1}

    .bottombar{display:flex; align-items:center; justify-content:center; gap:10px; padding:8px; background:rgba(0,0,0,.5); font-size:13px; border-top:1px solid rgba(255,255,255,.08)}
    .mini-controls{position:absolute; bottom:56px; left:0; right:0; display:flex; justify-content:center; gap:8px}
    .ctl{background:rgba(0,0,0,.4); border:1px solid rgba(255,255,255,.18); color:#fff; width:34px; height:34px; border-radius:999px; display:grid; place-items:center}
    .ctl.heart{width:auto; padding:0 10px; font-weight:800}

    .eq{display:inline-flex; gap:3px; align-items:flex-end; height:14px}
    .eq i{width:3px; height:6px; background:linear-gradient(180deg,var(--brand2),var(--brand1)); border-radius:2px; animation: bounce 900ms ease-in-out infinite}
    .eq i:nth-child(2){animation-delay:.12s} .eq i:nth-child(3){animation-delay:.24s} .eq i:nth-child(4){animation-delay:.36s}
    @keyframes bounce { 0%,100%{ height:4px } 50%{ height:14px } }

    .mini-play{position:absolute; right:10px; top:10px; display:flex; align-items:center; gap:8px; font-size:12px; padding:8px 10px; border-radius:999px; border:1px solid rgba(255,255,255,.18); background:rgba(0,0,0,.35)}

    /* BUILDER */
    #builder{padding:20px 0 56px; background:linear-gradient(180deg, rgba(255,255,255,.03), transparent)}
    .builder-grid{display:grid; grid-template-columns:1fr 1fr; gap:18px}
    .panel{background:var(--card); border:1px solid var(--line); border-radius:16px; box-shadow:var(--shadow)}
    .panel header{position:static; background:none; border:0}
    .panel .hd{padding:14px 16px; border-bottom:1px solid var(--line); font-weight:800}
    .panel .bd{padding:14px 16px}
    .rows{display:grid; gap:12px}
    .row{display:grid; gap:8px}
    label{font-size:13px; color:#d8d2e5}
    input[type="text"], input[type="date"], input[type="url"], input[type="color"], textarea{width:100%; padding:10px 12px; border-radius:10px; border:1px solid #303042; background:#1d1d2a; color:#fff}
    input[type=file]{width:100%}
    .small{font-size:12px; color:#a9a4b8}
    .list{display:grid; gap:10px}
    .item{display:grid; grid-template-columns:auto 1fr auto; gap:10px; align-items:center; background:#1b1b28; border:1px solid #2b2b3d; padding:8px; border-radius:10px}
    .thumb{width:56px; height:56px; object-fit:cover; border-radius:8px}
    .item .cap{display:grid; gap:6px}
    .item .btns{display:flex; gap:6px}

    .actions{display:flex; gap:10px; flex-wrap:wrap}

    .muted{color:#bdb7c9}

    /* SE√á√ïES (features/steps/pricing/faq) */
    section.std{padding:48px 0}
    h2{font-size:26px; margin:0 0 8px}
    p.lead{color:var(--muted); margin:0 0 20px}

    .grid-3{display:grid; grid-template-columns:repeat(3,1fr); gap:14px}
    .card{background:var(--card); border:1px solid var(--line); border-radius:var(--radius); padding:16px; box-shadow:0 10px 26px rgba(0,0,0,.25)}
    .card h3{margin:0 0 6px}
    .card p{color:var(--muted)}

    .steps{display:grid; grid-template-columns:repeat(4,1fr); gap:14px}
    .step{background:var(--card); border:1px solid var(--line); border-radius:var(--radius); padding:16px}
    .step .n{ width:34px; height:34px; display:grid; place-items:center; border-radius:10px; font-weight:800; background:linear-gradient(135deg,var(--accent),#7c3aed); box-shadow:var(--shadow)}

    .pricing{display:grid; grid-template-columns:1.2fr .8fr; gap:16px}
    .price-card{background:linear-gradient(160deg, #231f2a, #1a1822); border:1px solid rgba(255,255,255,.06); border-radius:22px; padding:20px; box-shadow:0 30px 60px rgba(255,77,109,.12)}
    .price{font-size:40px; font-weight:800}

    details{background:var(--card); border:1px solid var(--line); border-radius:14px; padding:14px 16px}
    summary{cursor:pointer; font-weight:700}
    summary::-webkit-details-marker{display:none}
    details + details{margin-top:10px}

    footer{padding:26px 0 36px; border-top:1px dashed rgba(255,255,255,.08); color:#bdb8c9}

    /* HEARTS */
    #hearts-container{position:fixed; inset:0; pointer-events:none; z-index:10}
    .heart{position:fixed; top:-10vh; font-size:var(--size,18px); transform:translateY(-10vh) rotate(0deg); will-change:transform, opacity; filter:drop-shadow(0 8px 12px rgba(255,77,109,.25)); animation: fall var(--dur,9s) linear forwards, sway var(--dur,9s) ease-in-out infinite; opacity:.95}
    @keyframes fall{ to{ transform:translateY(110vh) rotate(360deg); opacity:0 } }
    @keyframes sway{ 0%,100%{ margin-left:-10px } 50%{ margin-left:10px } }

    /* RESPONSIVO */
    @media (max-width: 1024px){ .hero-grid{grid-template-columns:1fr; gap:18px} .pricing{grid-template-columns:1fr} .steps{grid-template-columns:1fr 1fr} .builder-grid{grid-template-columns:1fr} }
    @media (max-width: 560px){ .grid-3{grid-template-columns:1fr} .steps{grid-template-columns:1fr} .phone{border-radius:28px} .phone-screen{inset:10px; border-radius:20px} }
  </style>
</head>
<body>
  <div id="hearts-container" aria-hidden="true"></div>

  <header>
    <div class="wrap header-inner">
      <div class="brand">
        <div class="brand-badge" aria-hidden="true">üíú</div>
        <h1>Amor em C√≥digos</h1>
      </div>
      <button id="cta-top" class="btn btn-primary">Criar Mini Site</button>
    </div>
  </header>

  <main>
    <!-- HERO com preview no lado direito -->
    <section class="hero">
      <div class="wrap hero-grid">
        <div>
          <div class="eyebrow">Dia dos Namorados</div>
          <h2 class="title">Uma <span style="color:#a78bfa">homenagem de amor</span> que ficar√° marcada para sempre.</h2>
          <p class="subtitle">Entregue o <strong>QR Code</strong> ou envie o <strong>link</strong> do Mini Site. Fotos com <strong>mensagem embaixo</strong> e <strong>m√∫sica de fundo</strong>.</p>
          <div class="cta">
            <button id="cta" class="btn btn-primary">Come√ßar agora</button>
            <a class="btn btn-ghost" href="#como-funciona">Como funciona</a>
          </div>
          <div class="note">Edi√ß√£o simples ‚Ä¢ Visual profissional ‚Ä¢ Compartilhe em segundos</div>
        </div>

        <!-- PHONE PREVIEW, lado direito -->
        <div class="phone" aria-label="Pr√©via do mini site no celular">
          <div class="phone-screen">
            <div class="preview">
              <div class="topbar"><span class="dot"></span> <strong class="titlebar" id="pvTitle">Mini Site do Amor</strong></div>
              <div class="slider" id="slider">
                <!-- slides gerados dinamicamente -->
              </div>
              <button class="mini-play" id="miniPlay" title="Tocar m√∫sica do casal">‚ñ∂Ô∏é M√∫sica</button>
              <div class="mini-controls"><span class="ctl" id="prev">‚Äπ</span><span class="ctl heart">‚ù§</span><span class="ctl" id="next">‚Ä∫</span></div>
              <div class="bottombar"><div class="eq" aria-hidden="true"><i></i><i></i><i></i><i></i></div><small style="opacity:.9">M√∫sica do casal</small></div>
              <audio id="track" autoplay loop playsinline></audio>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- BUILDER WIZARD -->
    <section id="builder">
      <div class="wrap builder-grid">
        <div class="panel">
          <div class="hd">Passo a passo ‚Äî Crie seu mini site</div>
          <div class="bd">
            <div class="rows">
              <!-- PASSO 1: T√≠tulo / Nomes -->
              <div class="row">
                <label for="names">1) Nomes ou frase (ex.: Bruna e Fabrizio)</label>
                <input id="names" type="text" placeholder="Digite os nomes ou uma frase"/>
              </div>

              <!-- PASSO 2: Fotos + Mensagens -->
              <div class="row">
                <label for="photos">2) Fotos (at√© 7) com mensagem embaixo</label>
                <input id="photos" type="file" accept="image/*" multiple/>
                <div class="small">Ap√≥s enviar, preencha a mensagem de cada foto. Use as setas para ordenar.</div>
                <div id="photoList" class="list"></div>
              </div>

              <!-- PASSO 3: Data especial -->
              <div class="row">
                <label for="date">3) Data especial (opcional) ‚Äî para o contador "Juntos h√°"</label>
                <input id="date" type="date"/>
              </div>

              <!-- PASSO 4: M√∫sica -->
              <div class="row">
                <label>4) M√∫sica do casal</label>
                <div class="rows">
                  <input id="musicFile" type="file" accept="audio/*"/>
                  <input id="musicUrl" type="url" placeholder="ou cole um link MP3 (https://...)"/>
                </div>
                <div class="actions"><button class="btn" id="testMusic">Testar m√∫sica</button></div>
              </div>

              <!-- PASSO 5: Tema -->
              <div class="row">
                <label>5) Cores do tema</label>
                <div class="actions">
                  <div>
                    <div class="small">Prim√°ria</div>
                    <input id="color1" type="color" value="#ff4d6d"/>
                  </div>
                  <div>
                    <div class="small">Secund√°ria</div>
                    <input id="color2" type="color" value="#ff99ac"/>
                  </div>
                </div>
              </div>

              <!-- PASSO 6: Gerar -->
              <div class="row">
                <label>6) Gerar & baixar</label>
                <div class="rows">
                  <button class="btn btn-primary" id="btnDownload">Baixar mini site (.html)</button>
                  <div class="small">Depois de hospedar seu arquivo, informe a URL p√∫blica e gere um QR Code.</div>
                  <input id="publicUrl" type="url" placeholder="URL p√∫blica (https://...)"/>
                  <div class="actions">
                    <button class="btn" id="genQR">Gerar QR Code</button>
                    <img id="qrImg" style="width:160px;height:160px;border-radius:12px;display:none" alt="QR Code"/>
                  </div>
                </div>
              </div>

            </div>
          </div>
        </div>

        <div class="panel">
          <div class="hd">Dicas & Ajuda</div>
          <div class="bd">
            <ul class="muted">
              <li>Use de 3 a 7 fotos para um visual ideal. Cada foto ter√° sua <strong>mensagem embaixo</strong>.</li>
              <li>A m√∫sica pode ser arquivo ou link MP3. Alguns celulares pedem toque no bot√£o <em>‚ñ∂Ô∏é M√∫sica</em> para iniciar.</li>
              <li>As cores definem o gradiente do tema e dos cora√ß√µes.</li>
              <li>O bot√£o <strong>Baixar mini site</strong> gera um arquivo <code>.html</code> com tudo embutido (fotos e m√∫sica).</li>
            </ul>
          </div>
        </div>
      </div>
    </section>

    <!-- FEATURES -->
    <section class="wrap std">
      <h2>Feito para encantar</h2>
      <p class="lead">Layout rom√¢ntico, anima√ß√µes suaves e detalhes que brilham ‚Äî perfeito para o seu Dia dos Namorados.</p>
      <div class="grid-3">
        <div class="card"><h3>üíú Design Personalizado</h3><p>Escolha cores, fontes e capa. O visual que combina com a hist√≥ria de voc√™s.</p></div>
        <div class="card"><h3>üîó Link & QR Code</h3><p>Compartilhe facilmente por link ou entregue um QR Code surpresa.</p></div>
        <div class="card"><h3>üéµ Trilha do casal</h3><p>Defina a m√∫sica que marca o relacionamento e torne o momento inesquec√≠vel.</p></div>
      </div>
    </section>

    <!-- COMO FUNCIONA / STEPS -->
    <section id="como-funciona" class="wrap std">
      <h2>Em 4 passos</h2>
      <p class="lead">Crie, pague e receba seu mini site ‚Äî tudo em minutos.</p>
      <div class="steps">
        <div class="step"><div class="n">1</div><h4>Personalize</h4><p>Fotos, mensagem e m√∫sica.</p></div>
        <div class="step"><div class="n">2</div><h4>Pagamento</h4><p>Processo simples e seguro.</p></div>
        <div class="step"><div class="n">3</div><h4>Receba o acesso</h4><p>Link e QR Code no seu e‚Äëmail.</p></div>
        <div class="step"><div class="n">4</div><h4>Compartilhe</h4><p>Entregue a surpresa e emocione üíû</p></div>
      </div>
    </section>

    <!-- PRICING / BENEFITS -->
    <section class="wrap std">
      <div class="pricing">
        <div class="price-card">
          <h3 style="margin:0 0 8px">Tudo que voc√™ recebe</h3>
          <ul class="ul" style="display:grid; gap:10px; margin:18px 0; padding-left:18px">
            <li>üíñ P√°gina personalizada e responsiva</li>
            <li>üíñ Tema especial de Dia dos Namorados</li>
            <li>üíñ QR Code e Link de acesso r√°pido</li>
            <li>üíñ At√© 7 fotos + 1 m√∫sica</li>
            <li>üíñ 1 ano de acesso</li>
            <li>üõ°Ô∏è Privacidade e qualidade garantidas</li>
          </ul>
          <div class="btn btn-ghost" style="display:inline-block">Oferta de temporada</div>
        </div>
        <div class="card" style="display:grid; align-content:center">
          <div style="opacity:.85">a partir de</div>
          <div class="price">R$ 25,00</div>
          <div style="opacity:.85">pagamento √∫nico</div>
          <div style="height:10px"></div>
          <button class="btn btn-primary" id="cta-pricing">Quero criar agora</button>
        </div>
      </div>
    </section>

    <!-- FAQ -->
    <section class="wrap std">
      <h2>Perguntas frequentes</h2>
      <details>
        <summary>O que √© o Mini Site do Amor?</summary>
        <p>√â uma p√°gina personalizada com fotos, <strong>mensagem logo abaixo</strong> e m√∫sica para celebrar o relacionamento e surpreender quem voc√™ ama.</p>
      </details>
      <details>
        <summary>Consigo editar depois de pronto?</summary>
        <p>Voc√™ poder√° solicitar ajustes antes de compartilhar o link final. Combine conosco a melhor forma de atualiza√ß√£o.</p>
      </details>
      <details>
        <summary>Como entrego a surpresa?</summary>
        <p>Voc√™ recebe um link e um QR Code. Envie por mensagem ou entregue impresso com um presente.</p>
      </details>
    </section>
  </main>

  <footer>
    <div class="wrap" style="display:flex; align-items:center; justify-content:space-between; gap:10px; flex-wrap:wrap">
      <div>¬© <span id="year"></span> Amor em C√≥digos ‚Äî Dia dos Namorados</div>
      <div style="display:flex; gap:12px; align-items:center">
        <a class="btn btn-ghost" href="#">Termos</a>
        <a class="btn btn-ghost" href="#">Privacidade</a>
      </div>
    </div>
  </footer>

  <script>
    const $ = (s, ctx=document) => ctx.querySelector(s);
    const $$ = (s, ctx=document) => [...ctx.querySelectorAll(s)];

    // ===== hearts (sempre ativos, com pausa quando aba oculta) =====
    const heartsContainer = document.getElementById('hearts-container');
    let heartTimer; let heartMs = window.matchMedia('(max-width:560px)').matches ? 320 : 220;
    function spawnHeart(){
      const el=document.createElement('span'); el.className='heart'; el.textContent=Math.random()<.5?'üíñ':'üíò';
      const size=14+Math.random()*20, dur=7+Math.random()*6, left=Math.random()*100;
      el.style.setProperty('--size',size+'px'); el.style.setProperty('--dur',dur+'s'); el.style.left=left+'vw'; el.style.opacity=0.75+Math.random()*0.25;
      heartsContainer.appendChild(el); setTimeout(()=>el.remove(),dur*1000);
    }
    function startHearts(){ heartTimer=setInterval(spawnHeart, heartMs); }
    function stopHearts(){ clearInterval(heartTimer); }
    document.addEventListener('visibilitychange',()=>{ document.hidden?stopHearts():startHearts(); });
    startHearts();

    // ===== STATE =====
    const state = {
      title: 'Mini Site do Amor',
      date: null,
      photos: [
        {src:'https://images.unsplash.com/photo-1520962918287-7448c2878f65?q=80&w=800&auto=format&fit=crop', cap:'Primeiro encontro ‚ú®'},
        {src:'https://images.unsplash.com/photo-1519744792095-2f2205e87b6f?q=80&w=800&auto=format&fit=crop', cap:'Nossas viagens üíû'},
        {src:'https://images.unsplash.com/photo-1518621736915-f3b1c41bfd00?q=80&w=800&auto=format&fit=crop', cap:'Para sempre n√≥s dois üíç'}
      ],
      music: {data:null, url:null},
      colors: {c1:'#ff4d6d', c2:'#ff99ac'}
    };

    // ===== PREVIEW RENDER =====
    const slider = $('#slider');
    const pvTitle = $('#pvTitle');
    const track = $('#track');
    function msSince(d){ const now=new Date(); const diff=now-d; const s=Math.floor(diff/1000); const m=Math.floor(s/60); const h=Math.floor(m/60); const days=Math.floor(h/24); return `${days} dias, ${h%24} horas, ${m%60} min, ${s%60} seg`; }

    function renderPreview(){
      pvTitle.textContent = state.title || 'Mini Site do Amor';
      slider.innerHTML='';
      state.photos.forEach((p,i)=>{
        const slide=document.createElement('div'); slide.className='slide'+(i===0?' show':'');
        slide.innerHTML = `
          <div class="slide-inner"><img src="${p.src}" alt="Foto ${i+1}"/></div>
          <div class="caption"><span>${p.cap||''}</span></div>
          <div class="since">${state.date?`Juntos h√°: ${msSince(state.date)}`:''}</div>`;
        slider.appendChild(slide);
      });
      // music
      if(state.music.data){ track.src = state.music.data; }
      else if(state.music.url){ track.src = state.music.url; }
      else { track.removeAttribute('src'); }
      // theme colors influence hearts via CSS variables if desired (skipped for brevity)
    }

    // initial render
    renderPreview();

    // slider controls
    let idx=0, timer=null, autoDelay=5000;
    function show(i){ const slides=$$('#slider .slide'); slides.forEach((s,j)=> s.classList.toggle('show', j===i)); }
    function go(i){ const len = state.photos.length; idx=(i+len)%len; show(idx); }
    function next(){ go(idx+1); }
    function prev(){ go(idx-1); }
    function startAuto(){ timer=setInterval(next, autoDelay); }
    function stopAuto(){ clearInterval(timer); timer=null; }
    $('#next').addEventListener('click', ()=>{ next(); stopAuto(); startAuto(); });
    $('#prev').addEventListener('click', ()=>{ prev(); stopAuto(); startAuto(); });
    startAuto();

    // ===== FORM HANDLERS =====
    $('#names').addEventListener('input', e=>{ state.title = e.target.value.trim()||'Mini Site do Amor'; renderPreview(); });
    $('#date').addEventListener('change', e=>{ state.date = e.target.value? new Date(e.target.value): null; renderPreview(); });

    // Photos upload
    const photoList = $('#photoList');
    $('#photos').addEventListener('change', async e=>{
      const files = [...e.target.files].slice(0,7);
      for(const f of files){
        const data = await fileToDataURL(f);
        state.photos.push({src:data, cap:`Nossa foto`});
      }
      drawPhotoList(); renderPreview(); e.target.value='';
    });

    function drawPhotoList(){
      photoList.innerHTML='';
      state.photos.forEach((p,i)=>{
        const el = document.createElement('div'); el.className='item';
        el.innerHTML = `
          <img class="thumb" src="${p.src}" alt="thumb ${i+1}">
          <div class="cap"><input type="text" value="${p.cap||''}" placeholder="Mensagem desta foto"/><div class="small">Foto ${i+1}</div></div>
          <div class="btns">
            <button class="btn" data-act="up">‚ñ≤</button>
            <button class="btn" data-act="down">‚ñº</button>
            <button class="btn" data-act="del">‚úï</button>
          </div>`;
        const [inp] = el.querySelectorAll('input');
        inp.addEventListener('input', ev=>{ p.cap = ev.target.value; renderPreview(); });
        el.querySelector('[data-act="up"]').addEventListener('click',()=>{ if(i>0){ const tmp=state.photos[i-1]; state.photos[i-1]=state.photos[i]; state.photos[i]=tmp; drawPhotoList(); renderPreview(); }});
        el.querySelector('[data-act="down"]').addEventListener('click',()=>{ if(i<state.photos.length-1){ const tmp=state.photos[i+1]; state.photos[i+1]=state.photos[i]; state.photos[i]=tmp; drawPhotoList(); renderPreview(); }});
        el.querySelector('[data-act="del"]').addEventListener('click',()=>{ state.photos.splice(i,1); drawPhotoList(); renderPreview(); });
        photoList.appendChild(el);
      });
    }
    drawPhotoList();

    // Music
    $('#testMusic').addEventListener('click', async()=>{
      const file = $('#musicFile').files[0];
      const url  = $('#musicUrl').value.trim();
      if(file){ state.music.data = await fileToDataURL(file); state.music.url=null; }
      else if(url){ state.music.url = url; state.music.data=null; }
      renderPreview();
      try{ track.volume=.7; await track.play(); }catch{}
    });

    // Theme colors
    $('#color1').addEventListener('change', e=>{ state.colors.c1 = e.target.value; document.documentElement.style.setProperty('--brand1', e.target.value); });
    $('#color2').addEventListener('change', e=>{ state.colors.c2 = e.target.value; document.documentElement.style.setProperty('--brand2', e.target.value); });

    // CTA scroll
    ['#cta','#cta-top','#cta-pricing'].forEach(sel=> $(sel)?.addEventListener('click', ()=> document.querySelector('#builder')?.scrollIntoView({behavior:'smooth'})) );

    // Helpers
    function fileToDataURL(file){ return new Promise(res=>{ const r=new FileReader(); r.onload=()=>res(r.result); r.readAsDataURL(file); }); }

    // ===== DOWNLOAD MINI-SITE =====
    $('#btnDownload').addEventListener('click', ()=>{
      const html = generateMiniSiteHTML();
      const blob = new Blob([html], {type:'text/html'});
      const a = document.createElement('a'); a.href = URL.createObjectURL(blob);
      a.download = `mini-site-amor.html`; a.click(); URL.revokeObjectURL(a.href);
    });

    function esc(s=''){ return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

    function generateMiniSiteHTML(){
      const photos = state.photos.map(p=>({src:p.src, cap:esc(p.cap||'')}));
      const title = esc(state.title||'Mini Site do Amor');
      const date  = state.date? state.date.toISOString(): '';
      const music = state.music.data || state.music.url || '';
      const c1 = state.colors.c1, c2 = state.colors.c2;
      return `<!doctype html><html lang="pt-BR"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>${title}</title>
<style>
  :root{--bg:#0b0a0f;--card:#171720;--line:#262637;--text:#fbf9ff;--muted:#cbc6d8;--brand1:${c1};--brand2:${c2}}
  *{box-sizing:border-box}body{margin:0;font-family:Inter,system-ui,Arial,sans-serif;color:var(--text);background:var(--bg);overflow-x:hidden}
  .wrap{max-width:820px;margin:0 auto;padding:0 16px}
  header{padding:16px 0;text-align:center;border-bottom:1px solid rgba(255,255,255,.06)}
  h1{margin:0;font-size:22px}
  .phone{margin:18px auto; width:260px; border-radius:30px; background:#111; border:1px solid rgba(255,255,255,.08); box-shadow:0 18px 36px rgba(0,0,0,.45); overflow:hidden}
  .screen{position:relative; aspect-ratio:9/16; overflow:hidden}
  .slide{position:absolute; inset:0; display:grid; grid-template-rows:1fr auto auto; gap:8px; padding:12px; opacity:0; transition:opacity .6s ease}
  .slide.show{opacity:1}
  .slide img{max-width:100%; max-height:64%; border-radius:14px; box-shadow:0 10px 22px rgba(0,0,0,.5); object-fit:contain}
  .caption{display:flex; justify-content:center}
  .caption span{font-size:13px; color:#fff; background:rgba(0,0,0,.45); border:1px solid rgba(255,255,255,.12); padding:8px 12px; border-radius:10px}
  .since{font-size:12px; color:#ddd; text-align:center; opacity:.9}
  .bar{position:absolute; bottom:0; left:0; right:0; text-align:center; padding:8px; font-size:13px; background:rgba(0,0,0,.5); border-top:1px solid rgba(255,255,255,.08)}
  #hearts{position:fixed; inset:0; pointer-events:none}
  .heart{position:fixed; top:-10vh; font-size:var(--size,18px); transform:translateY(-10vh) rotate(0deg); filter:drop-shadow(0 8px 12px rgba(255,77,109,.25)); animation:fall var(--dur,9s) linear forwards,sway var(--dur,9s) ease-in-out infinite; opacity:.95}
  @keyframes fall{ to{ transform:translateY(110vh) rotate(360deg); opacity:0 } } @keyframes sway{ 0%,100%{ margin-left:-10px } 50%{ margin-left:10px } }
</style></head><body>
<div id="hearts"></div>
<header class="wrap"><h1>${title}</h1></header>
<main class="wrap">
  <div class="phone"><div class="screen" id="scr"></div></div>
</main>
<audio id="aud" autoplay loop playsinline src="${music}"></audio>
<script>
  const data = {photos:${JSON.stringify(photos)}, date:'${date}'};
  const scr=document.getElementById('scr');
  function msSince(d){ if(!d) return ''; const dd=new Date(d); const now=new Date(); const s=Math.floor((now-dd)/1000); const m=Math.floor(s/60); const h=Math.floor(m/60); const days=Math.floor(h/24); return `${'Juntos h√°: '} ${days} dias, ${h%24} horas, ${m%60} min, ${s%60} seg`; }
  function render(){ scr.innerHTML=''; data.photos.forEach((p,i)=>{ const el=document.createElement('div'); el.className='slide'+(i===0?' show':''); el.innerHTML=`<div style="display:flex;align-items:center;justify-content:center"><img src='${p.src}' alt='foto ${i+1}'/></div><div class='caption'><span>${p.cap||''}</span></div><div class='since'>${msSince(data.date)}</div>`; scr.appendChild(el); }); }
  render(); let idx=0; setInterval(()=>{ const s=[...scr.children]; s[idx].classList.remove('show'); idx=(idx+1)%s.length; s[idx].classList.add('show'); }, 5000);
  // hearts
  const hc=document.getElementById('hearts'); function heart(){const e=document.createElement('span'); e.className='heart'; e.textContent=Math.random()<.5?'üíñ':'üíò'; const size=14+Math.random()*18, dur=7+Math.random()*6, left=Math.random()*100; e.style.setProperty('--size',size+'px'); e.style.setProperty('--dur',dur+'s'); e.style.left=left+'vw'; e.style.opacity=0.75+Math.random()*0.25; hc.appendChild(e); setTimeout(()=>e.remove(), dur*1000);} setInterval(heart, 240);
</script>
</body></html>`;
    }

    // ===== QR =====
    $('#genQR').addEventListener('click', ()=>{
      const url = $('#publicUrl').value.trim();
      if(!url){ alert('Informe uma URL p√∫blica para gerar o QR.'); return; }
      const img = $('#qrImg');
      img.src = `https://api.qrserver.com/v1/create-qr-code/?size=260x260&data=${encodeURIComponent(url)}`;
      img.style.display='block';
    });

    // ===== mini play (garantir autoplay em mobile) =====
    const miniPlay=$('#miniPlay');
    miniPlay.addEventListener('click', async()=>{ try{ track.volume=.7; if(track.paused) { await track.play(); miniPlay.textContent='‚è∏Ô∏é Pausar'; } else { track.pause(); miniPlay.textContent='‚ñ∂Ô∏é M√∫sica'; } }catch{} });

    // util
    document.getElementById('year')?.textContent = new Date().getFullYear();
  </script>
</body>
</html>
