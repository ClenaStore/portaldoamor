<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Amor em CÃ³digos â€¢ Criador de Mini Site</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#0b0a0f; --card:#171720; --line:#262637; --text:#fbf9ff; --muted:#cbc6d8;
      --accent:#a78bfa; --brand1:#ff4d6d; --brand2:#ff99ac;
      --shadow:0 8px 18px rgba(167,139,250,.18),0 6px 14px rgba(255,77,109,.12);
      --radius:14px; --maxw:900px;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:'Inter',system-ui,Arial,sans-serif;color:var(--text);background:var(--bg);overflow-x:hidden}
    .wrap{max-width:var(--maxw);margin:0 auto;padding:0 clamp(14px,3vw,24px)}

    header{text-align:center;padding:14px 0;background:linear-gradient(180deg,rgba(255,77,109,.2),transparent)}
    h1{margin:0;font-size:20px}

    section{padding:20px 0}
    h2{margin:0 0 10px;font-size:22px}

    .uploader{background:var(--card);padding:16px;border-radius:var(--radius);box-shadow:var(--shadow)}
    .photos{display:grid;grid-template-columns:repeat(auto-fill,minmax(120px,1fr));gap:12px;margin-top:12px}
    .card-photo{position:relative;background:#111;border:1px solid var(--line);border-radius:var(--radius);overflow:hidden}
    .card-photo img{width:100%;height:100px;object-fit:cover;display:block}
    .card-photo button{position:absolute;top:4px;right:4px;background:#ff4d6d;border:none;border-radius:50%;color:#fff;width:22px;height:22px;cursor:pointer}
    .caption{padding:6px}
    .caption input{width:100%;padding:6px;border-radius:8px;border:1px solid var(--line);background:#222;color:#fff;font-size:12px}

    .preview{margin-top:24px;text-align:center}
    .phone{margin:0 auto;width:220px;max-width:80vw;border-radius:20px;background:#111;border:1px solid rgba(255,255,255,.08);box-shadow:var(--shadow);overflow:hidden;position:relative}
    .phone-screen{position:relative;aspect-ratio:9/16;overflow:hidden}
    .slide{position:absolute;inset:0;display:grid;grid-template-rows:1fr auto auto;gap:6px;padding:8px;opacity:0;transition:opacity .6s ease; z-index:1}
    .slide img{max-width:100%;max-height:60%;border-radius:10px;box-shadow:0 6px 14px rgba(0,0,0,.45)}
    .slide.show{opacity:1}
    .caption span{font-size:12px;background:rgba(0,0,0,.45);padding:4px 8px;border-radius:6px}
    .bottombar{position:absolute;bottom:0;left:0;right:0;text-align:center;padding:6px;background:rgba(0,0,0,.45);font-size:12px}
    .title-overlay{position:absolute;top:8px;left:8px;right:8px;text-align:center;font-weight:800;font-size:14px;color:#fff;text-shadow:0 2px 8px rgba(0,0,0,.6);letter-spacing:.3px;z-index:2;pointer-events:none}
    .watermark{position:absolute;inset:0;display:grid;place-items:center;font-weight:800;font-size:22px;letter-spacing:2px;color:#fff;opacity:.08;transform:rotate(-18deg);z-index:0;pointer-events:none}

    .actions{margin-top:20px;display:flex;flex-wrap:wrap;gap:10px;justify-content:center}
    .btn{background:linear-gradient(135deg,var(--brand1),var(--brand2));color:#fff;border:none;padding:10px 16px;border-radius:10px;font-weight:600;cursor:pointer}
    .btn:active{transform:scale(.97)}

    #qrImg{margin-top:14px;display:none}
  </style>
</head>
<body>
  <header><h1>Amor em CÃ³digos â€¢ Criador de Mini Site</h1></header>

  <main class="wrap">
    <section>
      <h2>1) Nomes/Frase</h2>
      <input id="namesInput" type="text" placeholder="Ex.: Ana JÃºlia e Pedro" style="width:100%;padding:8px;border-radius:8px;border:1px solid var(--line);background:#222;color:#fff">
    </section>

    <section>
      <h2>2) Data especial (opcional) â€” para "Juntos hÃ¡:"</h2>
      <input id="dateInput" type="date" style="width:100%;padding:8px;border-radius:8px;border:1px solid var(--line);background:#222;color:#fff">
    </section>

    <section>
      <h2>3) Fotos (atÃ© 12)</h2>
      <div class="uploader">
        <input id="photoInput" type="file" accept="image/*" multiple>
        <div class="photos" id="photoList"></div>
      </div>
    </section>

    <section>
      <h2>4) MÃºsica (YouTube) â€” cole o link do vÃ­deo</h2>
      <input id="ytLink" type="url" placeholder="https://www.youtube.com/watch?v=..." style="width:100%;padding:8px;border-radius:8px;border:1px solid var(--line);background:#222;color:#fff">
    </section>

    <section class="preview">
      <h2>PrÃ©via (ao vivo)</h2>
      <div class="phone">
        <div class="phone-screen">
          <div class="title-overlay" id="titleOverlay"></div>
          <div class="watermark">Amor em CÃ³digos</div>
          <div class="slider" id="slider"></div>
          <div class="bottombar">ðŸŽµ MÃºsica do YouTube</div>
        </div>
      </div>
      <iframe id="ytPreview" width="0" height="0" style="position:absolute;left:-9999px;opacity:0" allow="autoplay; encrypted-media"></iframe>
    </section>

    <section class="actions">
      <button class="btn" id="btnDownload">Baixar Mini Site</button>
      <button class="btn" id="genQR">Gerar QR Code</button>
    </section>
    <img id="qrImg" alt="QR Code"/>
  </main>

  <footer style="text-align:center;padding:20px;color:#aaa">Â© <span id="year"></span> Amor em CÃ³digos</footer>

  <script>
    const photoInput=document.getElementById('photoInput');
    const photoList=document.getElementById('photoList');
    const slider=document.getElementById('slider');
    const namesInput=document.getElementById('namesInput');
    const titleOverlay=document.getElementById('titleOverlay');
    const dateInput=document.getElementById('dateInput');
    const ytInput=document.getElementById('ytLink');
    const ytPreview=document.getElementById('ytPreview');

    let photos=[]; let siteDate='';

    const esc=s=>String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
    const videoIdFromYouTube=url=>{try{const u=new URL(url);if(u.hostname.includes('youtu.be'))return u.pathname.slice(1);if(u.searchParams.get('v'))return u.searchParams.get('v');const m=url.match(/embed\/([\w-]{6,})/);return m?m[1]:'';}catch{return ''}};
    function msSince(d){if(!d) return '';const dd=new Date(d);const now=new Date();const s=Math.floor((now-dd)/1000);const m=Math.floor(s/60);const h=Math.floor(m/60);const days=Math.floor(h/24);return `Juntos hÃ¡: ${days} dias, ${h%24} horas, ${m%60} min, ${s%60} seg`;}

    photoInput.addEventListener('change',()=>{
      [...photoInput.files].forEach(file=>{const r=new FileReader();r.onload=()=>{photos.push({src:r.result,cap:''});renderPhotos();renderPreview();};r.readAsDataURL(file);});
      photoInput.value='';
    });

    function renderPhotos(){
      photoList.innerHTML='';
      photos.forEach((p,i)=>{
        const card=document.createElement('div');card.className='card-photo';
        card.innerHTML=`<img src="${p.src}" alt="foto"><button data-i="${i}">âœ•</button><div class='caption'><input type='text' placeholder='Mensagem' value='${esc(p.cap)}' data-cap='${i}'></div>`;
        photoList.appendChild(card);
      });
      photoList.querySelectorAll('button').forEach(btn=>btn.onclick=()=>{photos.splice(btn.dataset.i,1);renderPhotos();renderPreview();});
      photoList.querySelectorAll('input').forEach(inp=>inp.oninput=()=>{photos[inp.dataset.cap].cap=inp.value;renderPreview();});
    }

    namesInput.addEventListener('input',()=>{titleOverlay.textContent=namesInput.value.trim();});
    dateInput.addEventListener('change',()=>{siteDate=dateInput.value||'';renderPreview();});
    ytInput.addEventListener('input',()=>{updateMusic();});

    function updateMusic(){
      const id=videoIdFromYouTube(ytInput.value.trim());
      if(id){ytPreview.src=`https://www.youtube.com/embed/${id}?autoplay=1&mute=1&playsinline=1&loop=1&playlist=${id}`;}
      else{ytPreview.removeAttribute('src');}
    }

    function renderPreview(){
      slider.innerHTML='';
      if(photos.length===0){slider.innerHTML='<div style="display:grid;place-items:center;font-size:12px;color:#bbb">Adicione fotos para ver a prÃ©via aqui. Mensagem aparece abaixo da foto.</div>';return;}
      photos.forEach((p,i)=>{
        const slide=document.createElement('div');slide.className='slide'+(i===0?' show':'');
        slide.innerHTML=`<div style='display:flex;justify-content:center;align-items:center'><img src='${p.src}'/></div><div class='caption'><span>${esc(p.cap)}</span></div>${siteDate?`<div class='since'>${msSince(siteDate)}</div>`:''}`;
        slider.appendChild(slide);
      });
    }

    setInterval(()=>{
      const slides=slider.querySelectorAll('.slide');if(slides.length<2)return;
      const show=slider.querySelector('.show')||slides[0];let idx=[...slides].indexOf(show);
      show.classList.remove('show');idx=(idx+1)%slides.length;slides[idx].classList.add('show');
    },5000);

    document.getElementById('btnDownload').addEventListener('click',()=>{
      const yt=ytInput.value.trim();
      const html=generateHTML(photos,yt);
      const blob=new Blob([html],{type:'text/html'});
      const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download='mini-site.html';a.click();URL.revokeObjectURL(a.href);
    });

    function generateHTML(photos,yt){
      const id=videoIdFromYouTube(yt);
      const slides=photos.map((p,i)=>`<div class='slide${i===0?" show":""}'><div style='display:flex;justify-content:center;align-items:center'><img src='${p.src}'/></div><div class='caption'><span>${esc(p.cap)}</span></div>${siteDate?`<div class='since'>${msSince(siteDate)}</div>`:''}</div>`).join('');
      return `<!doctype html><html lang='pt-BR'><head><meta charset='utf-8'/><meta name='viewport' content='width=device-width, initial-scale=1'/><title>Mini Site do Amor</title><style>body{margin:0;background:#000;color:#fff;font-family:Inter,sans-serif;text-align:center}.phone{margin:20px auto;width:260px;border:1px solid #444;border-radius:20px;overflow:hidden;box-shadow:0 8px 20px rgba(0,0,0,.6);position:relative}.phone-screen{position:relative;aspect-ratio:9/16;overflow:hidden}.title-overlay{position:absolute;top:8px;left:8px;right:8px;text-align:center;font-weight:800;font-size:14px;color:#fff;text-shadow:0 2px 8px rgba(0,0,0,.6);letter-spacing:.3px;z-index:2;pointer-events:none}.watermark{position:absolute;inset:0;display:grid;place-items:center;font-weight:800;font-size:22px;letter-spacing:2px;color:#fff;opacity:.08;transform:rotate(-18deg);z-index:0;pointer-events:none}.slide{position:absolute;inset:0;display:grid;grid-template-rows:1fr auto auto;gap:6px;padding:8px;opacity:0;transition:opacity .6s ease;z-index:1}.slide.show{opacity:1}.slide img{max-width:100%;max-height:66%;border-radius:10px;box-shadow:0 6px 14px rgba(0,0,0,.45)}.caption span{font-size:12px;background:rgba(0,0,0,.45);padding:4px 8px;border-radius:6px}.since{font-size:12px;color:#ddd;opacity:.9}.bottombar{position:absolute;bottom:0;left:0;right:0;background:rgba(0,0,0,.45);padding:6px;font-size:12px}</style></head><body><div class='phone'><div class='phone-screen' id='slider'><div class='title-overlay'>${esc(namesInput.value)}</div><div class='watermark'>Amor em CÃ³digos</div>${slides}</div><div class='bottombar'>ðŸŽµ MÃºsica do YouTube</div></div><iframe width='0' height='0' src='https://www.youtube.com/embed/${id}?autoplay=1&mute=1&playsinline=1&loop=1&playlist=${id}' frameborder='0' allow='autoplay; encrypted-media' allowfullscreen></iframe><script>setInterval(()=>{const slides=document.querySelectorAll('.slide');if(slides.length>0){const show=document.querySelector('.show')||slides[0];let idx=[...slides].indexOf(show);show.classList.remove('show');idx=(idx+1)%slides.length;slides[idx].classList.add('show');}},5000);</script></body></html>`;
    }

    document.getElementById('genQR').addEventListener('click',()=>{
      const urlPrompt=prompt('Cole a URL pÃºblica do mini site hospedado:');
      if(urlPrompt){const img=document.getElementById('qrImg');img.src=`https://api.qrserver.com/v1/create-qr-code/?size=260x260&data=${encodeURIComponent(urlPrompt)}`;img.style.display='block';}
    });

    document.getElementById('year').textContent=new Date().getFullYear();
  </script>
</body>
</html>
