<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Construtor • Mini Site do Amor (Cards + QR)</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#0b0a0f; --card:#171720; --line:#262637; --text:#fbf9ff; --muted:#cbc6d8;
      --brand1:#ff4d6d; --brand2:#ff99ac; --accent:#a78bfa; --radius:16px; --maxw:1100px;
      --shadow:0 8px 20px rgba(167,139,250,.16), 0 8px 24px rgba(255,77,109,.12);
    }
    *{box-sizing:border-box}
    body{margin:0; font-family:'Inter',system-ui,Arial,sans-serif; color:var(--text); background:var(--bg);}
    .wrap{max-width:var(--maxw); margin:0 auto; padding:0 clamp(14px,3vw,24px)}
    header{position:sticky; top:0; z-index:10; background:linear-gradient(180deg, rgba(13,12,18,.92), rgba(13,12,18,.65)); border-bottom:1px solid rgba(255,255,255,.06)}
    .head{display:flex; align-items:center; justify-content:space-between; gap:12px; padding:12px 0}
    h1{margin:0; font-size:18px}
    .btn{border:0; border-radius:12px; padding:10px 14px; font-weight:800; cursor:pointer; color:#fff; background:#2a2936}
    .btn-primary{background:linear-gradient(135deg,var(--brand1),var(--brand2)); box-shadow:var(--shadow)}
    .btn-ghost{background:#242432}
    .grid{display:grid; grid-template-columns:1.1fr .9fr; gap:18px}
    @media (max-width: 900px){ .grid{grid-template-columns:1fr} }

    /* Painéis */
    .panel{background:var(--card); border:1px solid var(--line); border-radius:16px; box-shadow:var(--shadow)}
    .panel header{padding:12px 14px; border-bottom:1px solid var(--line); font-weight:800}
    .panel .bd{padding:14px}
    label{font-size:13px; color:#e7e2f9}
    input[type=text], input[type=url], input[type=date]{width:100%; background:#1b1b28; color:#fff; border:1px solid #2f2f45; border-radius:10px; padding:10px 12px}
    input[type=file]{width:100%}
    .small{font-size:12px; color:#a9a4b8}

    /* Cards de foto */
    .cards{display:grid; grid-template-columns:repeat(auto-fill,minmax(150px,1fr)); gap:12px}
    .card-u{background:#1b1b28; border:1px solid #2e2e40; border-radius:12px; overflow:hidden; display:grid; grid-template-rows:110px auto auto;}
    .card-u .thumb{width:100%; height:110px; object-fit:cover}
    .card-u textarea{resize:vertical; min-height:56px; background:#161623; color:#fff; border:1px solid #2c2c3e; border-radius:8px; margin:10px; padding:8px 10px}
    .card-u .row{display:flex; gap:8px; align-items:center; justify-content:space-between; padding:10px}
    .pill{font-size:11px; padding:4px 8px; border-radius:999px; background:#242436; border:1px solid #33324a}

    /* Preview Phone pequeno (não corta) */
    .phone{margin:0 auto; width:220px; max-width:70vw; border-radius:24px; background:#111; border:1px solid rgba(255,255,255,.08); box-shadow:var(--shadow); overflow:hidden}
    .screen{position:relative; aspect-ratio:9/18; overflow:hidden}
    .slide{position:absolute; inset:0; display:grid; grid-template-rows:1fr auto auto; gap:6px; padding:8px; opacity:0; transition:opacity .5s ease}
    .slide img{max-width:100%; max-height:58%; border-radius:10px; box-shadow:0 6px 14px rgba(0,0,0,.45); object-fit:contain}
    .caption{text-align:center}
    .caption span{font-size:12px; background:rgba(0,0,0,.45); padding:4px 8px; border-radius:8px}
    .since{font-size:11px; color:#ccc; opacity:.9; text-align:center}
    .slide.show{opacity:1}
    .bar{position:absolute; bottom:0; left:0; right:0; text-align:center; padding:6px; background:rgba(0,0,0,.45); font-size:11px}

    /* QR */
    .qr{display:flex; align-items:center; gap:12px; flex-wrap:wrap}
    .qr img{width:160px; height:160px; border-radius:12px; border:1px solid #2f2f45}
  </style>
</head>
<body>
  <header>
    <div class="wrap head">
      <h1>Construtor • Mini Site do Amor</h1>
      <div style="display:flex; gap:8px; align-items:center">
        <button class="btn btn-primary" id="btnDownload">Baixar Mini Site (.html)</button>
      </div>
    </div>
  </header>

  <main class="wrap" style="padding:18px 0 60px">
    <div class="grid">
      <!-- Painel esquerdo: Builder -->
      <div class="panel">
        <header>Passo a passo</header>
        <div class="bd">
          <div class="rows" style="display:grid; gap:12px">
            <div class="row">
              <label for="names">1) Nomes/Frase</label>
              <input id="names" type="text" placeholder="Ex.: Bruna e Fabrizio"/>
            </div>

            <div class="row">
              <label for="date">2) Data especial (opcional) — para "Juntos há:"</label>
              <input id="date" type="date"/>
            </div>

            <div class="row">
              <label for="photos">3) Fotos (até 10)</label>
              <input id="photos" type="file" accept="image/*" multiple/>
              <div class="small">Cada foto vira um <strong>card pequeno</strong>. Edite a mensagem e use Excluir para remover.</div>
              <div id="cards" class="cards"></div>
            </div>

            <div class="row">
              <label for="yt">4) Música (YouTube) — cole o link do vídeo</label>
              <input id="yt" type="url" placeholder="https://www.youtube.com/watch?v=..."/>
              <div class="small">Tentaremos reproduzir automaticamente (alguns celulares pedem interação). Recomendo playlist/vídeo sem anúncios.</div>
            </div>

            <div class="row">
              <label for="publicUrl">5) URL pública do seu mini site (depois de hospedar)</label>
              <input id="publicUrl" type="url" placeholder="https://seusite.com/mini.html"/>
              <div class="qr">
                <button class="btn btn-ghost" id="genQR">Gerar QR Code</button>
                <img id="qr" alt="QR Code" style="display:none"/>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Painel direito: Preview -->
      <div class="panel">
        <header>Prévia (cabe no celular)</header>
        <div class="bd" style="display:grid; gap:12px; place-items:center">
          <div class="phone">
            <div class="screen" id="screen"></div>
          </div>
          <div class="small">As fotos aparecem menores com <strong>mensagem embaixo</strong>.</div>
        </div>
      </div>
    </div>
  </main>

  <script>
    const $ = (s, c=document)=>c.querySelector(s); const $$ = (s, c=document)=>[...c.querySelectorAll(s)];
    const cards = $('#cards'); const screen = $('#screen');
    const state = { title:'Mini Site do Amor', date:'', yt:'', slides: [] };

    // util
    function fileToDataURL(file){ return new Promise(res=>{ const r=new FileReader(); r.onload=()=>res(r.result); r.readAsDataURL(file); }); }
    function videoIdFromYouTube(url){ try{ const u=new URL(url); if(u.hostname.includes('youtu.be')) return u.pathname.slice(1); const id=u.searchParams.get('v'); return id; }catch{ return ''; } }

    // builder inputs
    $('#names').addEventListener('input', e=>{ state.title = e.target.value.trim()||'Mini Site do Amor'; render(); });
    $('#date').addEventListener('change', e=>{ state.date = e.target.value || ''; render(); });
    $('#yt').addEventListener('input', e=>{ state.yt = e.target.value.trim(); render(); });
    $('#photos').addEventListener('change', async e=>{
      const files = [...e.target.files].slice(0,10);
      for(const f of files){ const data = await fileToDataURL(f); state.slides.push({src:data, cap:''}); }
      e.target.value=''; drawCards(); render();
    });

    function drawCards(){
      cards.innerHTML='';
      state.slides.forEach((s,i)=>{
        const el=document.createElement('div'); el.className='card-u';
        el.innerHTML=`<img class="thumb" src="${s.src}" alt="foto ${i+1}">
          <textarea placeholder="Mensagem desta foto...">${s.cap||''}</textarea>
          <div class="row"><span class="pill">Foto ${i+1}</span>
            <div style="display:flex; gap:6px">
              <button class="btn" data-act="up">▲</button>
              <button class="btn" data-act="down">▼</button>
              <button class="btn" data-act="del" style="background:#8b1d2c">Excluir</button>
            </div>
          </div>`;
        el.querySelector('textarea').addEventListener('input',ev=>{ s.cap = ev.target.value; render(); });
        el.querySelector('[data-act="up"]').addEventListener('click',()=>{ if(i>0){ [state.slides[i-1],state.slides[i]]=[state.slides[i],state.slides[i-1]]; drawCards(); render(); }});
        el.querySelector('[data-act="down"]').addEventListener('click',()=>{ if(i<state.slides.length-1){ [state.slides[i+1],state.slides[i]]=[state.slides[i],state.slides[i+1]]; drawCards(); render(); }});
        el.querySelector('[data-act="del"]').addEventListener('click',()=>{ state.slides.splice(i,1); drawCards(); render(); });
        cards.appendChild(el);
      });
    }

    function msSince(d){ if(!d) return ''; const dd=new Date(d); const now=new Date(); const s=Math.floor((now-dd)/1000); const m=Math.floor(s/60); const h=Math.floor(m/60); const days=Math.floor(h/24); return `Juntos há: ${days} dias, ${h%24} horas, ${m%60} min, ${s%60} seg`; }

    function render(){
      screen.innerHTML='';
      if(state.slides.length===0){ screen.innerHTML='<div style="padding:14px; color:#bbb; font-size:13px; text-align:center">Adicione fotos para ver aqui. As mensagens aparecem logo abaixo.</div>'; return; }
      state.slides.forEach((p,i)=>{
        const slide=document.createElement('div'); slide.className='slide'+(i===0?' show':'');
        slide.innerHTML=`<div style="display:flex;align-items:center;justify-content:center"><img src="${p.src}" alt="foto ${i+1}"></div>
                          <div class="caption"><span>${(p.cap||'').replace(/</g,'&lt;')}</span></div>
                          <div class="since">${msSince(state.date)}</div>`;
        screen.appendChild(slide);
      });
    }

    // autoplay simples
    let idx=0; function tick(){ const s=$$('.slide', screen); if(s.length<2) return; s[idx].classList.remove('show'); idx=(idx+1)%s.length; s[idx].classList.add('show'); }
    setInterval(tick, 4800);

    // QR Code
    $('#genQR').addEventListener('click', ()=>{
      const url=$('#publicUrl').value.trim(); if(!url){ alert('Cole a URL pública do seu mini site já hospedado.'); return; }
      const img=$('#qr'); img.src=`https://api.qrserver.com/v1/create-qr-code/?size=260x260&data=${encodeURIComponent(url)}`; img.style.display='block';
    });

    // Download do mini site gerado (single-file)
    $('#btnDownload').addEventListener('click', ()=>{
      const html = generateMiniSite();
      const blob = new Blob([html], {type:'text/html'});
      const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='mini-site-amor.html'; a.click(); setTimeout(()=>URL.revokeObjectURL(a.href),1000);
    });

    function ytiFrame(id){
      if(!id) return '';
      // Autoplay no mobile geralmente exige interação; este embed tenta iniciar mudo e em loop.
      // O usuário pode tocar para ativar som quando abrir o mini site.
      const params='autoplay=1&mute=1&playsinline=1&loop=1&playlist='+id;
      return `<iframe title="YouTube player" width="0" height="0" style="position:absolute;left:-9999px;opacity:0" src="https://www.youtube.com/embed/${id}?${params}" allow="autoplay; encrypted-media" allowfullscreen></iframe>`;
    }

    function generateMiniSite(){
      const photos = state.slides.map(s=>({src:s.src, cap:(s.cap||'').replace(/</g,'&lt;')}));
      const date = state.date; const title = (state.title||'Mini Site do Amor').replace(/</g,'&lt;');
      const vid = videoIdFromYouTube(state.yt);
      return `<!doctype html><html lang="pt-BR"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>${title}</title>
<style>
  :root{--bg:#0b0a0f;--text:#fbf9ff;--muted:#cbc6d8}
  *{box-sizing:border-box}body{margin:0;font-family:Inter,system-ui,Arial,sans-serif;color:var(--text);background:var(--bg)}
  .wrap{max-width:840px;margin:0 auto;padding:0 16px}
  header{text-align:center;padding:16px 0;border-bottom:1px solid rgba(255,255,255,.06)}
  h1{margin:0;font-size:22px}
  .phone{margin:18px auto;width:260px;border-radius:28px;background:#111;border:1px solid rgba(255,255,255,.1);overflow:hidden;box-shadow:0 18px 36px rgba(0,0,0,.45)}
  .screen{position:relative;aspect-ratio:9/18;overflow:hidden}
  .slide{position:absolute;inset:0;display:grid;grid-template-rows:1fr auto auto;gap:8px;padding:10px;opacity:0;transition:opacity .6s ease}
  .slide.show{opacity:1}
  .slide img{max-width:100%;max-height:58%;border-radius:12px;object-fit:contain;box-shadow:0 8px 18px rgba(0,0,0,.5)}
  .caption{text-align:center}
  .caption span{font-size:13px;background:rgba(0,0,0,.45);padding:6px 10px;border-radius:8px}
  .since{font-size:12px;color:#ddd;opacity:.9;text-align:center}
  .bar{position:absolute;bottom:0;left:0;right:0;text-align:center;padding:8px;background:rgba(0,0,0,.45);font-size:12px}
</style></head><body>
<header class="wrap"><h1>${title}</h1></header>
<main class="wrap">
  <div class="phone"><div class="screen" id="scr"></div></div>
</main>
${ytiFrame(vid)}
<script>
  const data={photos:${JSON.stringify(photos)}, date:'${date}'};
  const scr=document.getElementById('scr');
  function ms(d){ if(!d) return ''; const dd=new Date(d); const now=new Date(); const s=Math.floor((now-dd)/1000); const m=Math.floor(s/60); const h=Math.floor(m/60); const days=Math.floor(h/24); return `Juntos há: ${days} dias, ${h%24} horas, ${m%60} min, ${s%60} seg`; }
  function render(){ scr.innerHTML=''; data.photos.forEach((p,i)=>{ const el=document.createElement('div'); el.className='slide'+(i===0?' show':''); el.innerHTML=`<div style="display:flex;justify-content:center;align-items:center"><img src='${p.src}' alt='foto ${i+1}'/></div><div class='caption'><span>${p.cap||''}</span></div><div class='since'>${ms(data.date)}</div>`; scr.appendChild(el); }); }
  render(); let idx=0; setInterval(()=>{ const s=[...scr.children]; if(s.length<2) return; s[idx].classList.remove('show'); idx=(idx+1)%s.length; s[idx].classList.add('show'); }, 5000);
</script>
</body></html>`;
    }

    // primeira renderização
    render();
  </script>
</body>
</html>
